#!/bin/bash

KIOSK_USER="kioskuser"
AUTOSTART_FILE="/home/$KIOSK_USER/.config/autostart/firefox-kiosk.desktop"
XMODMAP_FILE="/home/$KIOSK_USER/.Xmodmap"

echo "⛔ Desactivando modo kiosko..."

# --------------------------------------
# Cerrar Firefox si está abierto
# --------------------------------------
pkill -u "$KIOSK_USER" firefox 2>/dev/null

# --------------------------------------
# Restaurar teclado (quitar xmodmap)
# --------------------------------------
if [ -f "$XMODMAP_FILE" ]; then
    su - "$KIOSK_USER" -c "xmodmap -e 'clear all'"
fi

# --------------------------------------
# Eliminar autostart
# --------------------------------------
if [ -f "$AUTOSTART_FILE" ]; then
    rm -f "$AUTOSTART_FILE"
fi

# --------------------------------------
# Mensaje final
# --------------------------------------
echo "✅ Modo kiosko desactivado"
echo "ℹ️ Reinicia la sesión o el sistema para aplicar completamente los cambios"
